<!DOCTYPE html>
<html lang="en-US" dir="ltr">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Wąż w kieszeni | sporna.dev</title>
    <meta name="description" content="Python jako język programowania uważany jest za bardzo czytelny i samo opisujący się. Charakteryzuje się bardzo zwięzłą formą. Wiele osób miało już okazje rozpisywać się o składni i semantyce tego języka. Ja pójdę krok dalej. Wykorzystam wpływy krakowskie i poznańskie aby zaprzyjaźnić węża z kieszeni z Pythonem - spróbuje zaprezentować minimalizacje już minimalistycznego kodu.">
    <link rel="preload stylesheet" href="/assets/style.d84cba3f.css" as="style">
    
    <script type="module" src="/assets/app.4a1561a4.js"></script>
    <link rel="modulepreload" href="/assets/chunks/framework.fa3e7808.js">
    <link rel="modulepreload" href="/assets/chunks/theme.05a4749d.js">
    <link rel="modulepreload" href="/assets/blog_waz-w-kieszeni.md.4cf10ffc.lean.js">
    <script id="check-dark-mode">(()=>{const e=localStorage.getItem("vitepress-theme-appearance")||"dark",a=window.matchMedia("(prefers-color-scheme: dark)").matches;(!e||e==="auto"?a:e==="dark")&&document.documentElement.classList.add("dark")})();</script>
    <script id="check-mac-os">document.documentElement.classList.toggle("mac",/Mac|iPhone|iPod|iPad/i.test(navigator.platform));</script>
  </head>
  <body>
    <div id="app"><div class="Layout" data-v-5a346dfe><!--[--><!--]--><!--[--><span tabindex="-1" data-v-0f60ec36></span><a href="#VPContent" class="VPSkipLink visually-hidden" data-v-0f60ec36> Skip to content </a><!--]--><!----><header class="VPNav" data-v-5a346dfe data-v-ae24b3ad><div class="VPNavBar" data-v-ae24b3ad data-v-a0fd61f4><div class="container" data-v-a0fd61f4><div class="title" data-v-a0fd61f4><div class="VPNavBarTitle" data-v-a0fd61f4 data-v-86d1bed8><a class="title" href="/" data-v-86d1bed8><!--[--><!--]--><!----><!--[-->sporna.dev<!--]--><!--[--><!--]--></a></div></div><div class="content" data-v-a0fd61f4><div class="curtain" data-v-a0fd61f4></div><div class="content-body" data-v-a0fd61f4><!--[--><!--]--><div class="VPNavBarSearch search" data-v-a0fd61f4><!----></div><nav aria-labelledby="main-nav-aria-label" class="VPNavBarMenu menu" data-v-a0fd61f4 data-v-7f418b0f><span id="main-nav-aria-label" class="visually-hidden" data-v-7f418b0f>Main Navigation</span><!--[--><!--[--><a class="VPLink link VPNavBarMenuLink" href="/index.html" tabindex="0" data-v-7f418b0f data-v-42ef59de><!--[--><span data-v-42ef59de>O mnie</span><!--]--></a><!--]--><!--[--><a class="VPLink link VPNavBarMenuLink" href="/contact.html" tabindex="0" data-v-7f418b0f data-v-42ef59de><!--[--><span data-v-42ef59de>Kontakt</span><!--]--></a><!--]--><!--[--><a class="VPLink link VPNavBarMenuLink" href="/offer.html" tabindex="0" data-v-7f418b0f data-v-42ef59de><!--[--><span data-v-42ef59de>Oferta</span><!--]--></a><!--]--><!--[--><a class="VPLink link VPNavBarMenuLink active" href="/blog.html" tabindex="0" data-v-7f418b0f data-v-42ef59de><!--[--><span data-v-42ef59de>Blog</span><!--]--></a><!--]--><!--]--></nav><!----><div class="VPNavBarAppearance appearance" data-v-a0fd61f4 data-v-e6aabb21><button class="VPSwitch VPSwitchAppearance" type="button" role="switch" title="toggle dark mode" aria-checked="true" data-v-e6aabb21 data-v-ce54a7d1 data-v-b1685198><span class="check" data-v-b1685198><span class="icon" data-v-b1685198><!--[--><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="sun" data-v-ce54a7d1><path d="M12,18c-3.3,0-6-2.7-6-6s2.7-6,6-6s6,2.7,6,6S15.3,18,12,18zM12,8c-2.2,0-4,1.8-4,4c0,2.2,1.8,4,4,4c2.2,0,4-1.8,4-4C16,9.8,14.2,8,12,8z"></path><path d="M12,4c-0.6,0-1-0.4-1-1V1c0-0.6,0.4-1,1-1s1,0.4,1,1v2C13,3.6,12.6,4,12,4z"></path><path d="M12,24c-0.6,0-1-0.4-1-1v-2c0-0.6,0.4-1,1-1s1,0.4,1,1v2C13,23.6,12.6,24,12,24z"></path><path d="M5.6,6.6c-0.3,0-0.5-0.1-0.7-0.3L3.5,4.9c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0l1.4,1.4c0.4,0.4,0.4,1,0,1.4C6.2,6.5,5.9,6.6,5.6,6.6z"></path><path d="M19.8,20.8c-0.3,0-0.5-0.1-0.7-0.3l-1.4-1.4c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0l1.4,1.4c0.4,0.4,0.4,1,0,1.4C20.3,20.7,20,20.8,19.8,20.8z"></path><path d="M3,13H1c-0.6,0-1-0.4-1-1s0.4-1,1-1h2c0.6,0,1,0.4,1,1S3.6,13,3,13z"></path><path d="M23,13h-2c-0.6,0-1-0.4-1-1s0.4-1,1-1h2c0.6,0,1,0.4,1,1S23.6,13,23,13z"></path><path d="M4.2,20.8c-0.3,0-0.5-0.1-0.7-0.3c-0.4-0.4-0.4-1,0-1.4l1.4-1.4c0.4-0.4,1-0.4,1.4,0s0.4,1,0,1.4l-1.4,1.4C4.7,20.7,4.5,20.8,4.2,20.8z"></path><path d="M18.4,6.6c-0.3,0-0.5-0.1-0.7-0.3c-0.4-0.4-0.4-1,0-1.4l1.4-1.4c0.4-0.4,1-0.4,1.4,0s0.4,1,0,1.4l-1.4,1.4C18.9,6.5,18.6,6.6,18.4,6.6z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="moon" data-v-ce54a7d1><path d="M12.1,22c-0.3,0-0.6,0-0.9,0c-5.5-0.5-9.5-5.4-9-10.9c0.4-4.8,4.2-8.6,9-9c0.4,0,0.8,0.2,1,0.5c0.2,0.3,0.2,0.8-0.1,1.1c-2,2.7-1.4,6.4,1.3,8.4c2.1,1.6,5,1.6,7.1,0c0.3-0.2,0.7-0.3,1.1-0.1c0.3,0.2,0.5,0.6,0.5,1c-0.2,2.7-1.5,5.1-3.6,6.8C16.6,21.2,14.4,22,12.1,22zM9.3,4.4c-2.9,1-5,3.6-5.2,6.8c-0.4,4.4,2.8,8.3,7.2,8.7c2.1,0.2,4.2-0.4,5.8-1.8c1.1-0.9,1.9-2.1,2.4-3.4c-2.5,0.9-5.3,0.5-7.5-1.1C9.2,11.4,8.1,7.7,9.3,4.4z"></path></svg><!--]--></span></span></button></div><div class="VPSocialLinks VPNavBarSocialLinks social-links" data-v-a0fd61f4 data-v-0394ad82 data-v-7bc22406><!--[--><a class="VPSocialLink no-icon" href="https://github.com/jsporna" aria-label="github" target="_blank" rel="noopener" data-v-7bc22406 data-v-f80f8133><svg role="img" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><title>GitHub</title><path d="M12 .297c-6.63 0-12 5.373-12 12 0 5.303 3.438 9.8 8.205 11.385.6.113.82-.258.82-.577 0-.285-.01-1.04-.015-2.04-3.338.724-4.042-1.61-4.042-1.61C4.422 18.07 3.633 17.7 3.633 17.7c-1.087-.744.084-.729.084-.729 1.205.084 1.838 1.236 1.838 1.236 1.07 1.835 2.809 1.305 3.495.998.108-.776.417-1.305.76-1.605-2.665-.3-5.466-1.332-5.466-5.93 0-1.31.465-2.38 1.235-3.22-.135-.303-.54-1.523.105-3.176 0 0 1.005-.322 3.3 1.23.96-.267 1.98-.399 3-.405 1.02.006 2.04.138 3 .405 2.28-1.552 3.285-1.23 3.285-1.23.645 1.653.24 2.873.12 3.176.765.84 1.23 1.91 1.23 3.22 0 4.61-2.805 5.625-5.475 5.92.42.36.81 1.096.81 2.22 0 1.606-.015 2.896-.015 3.286 0 .315.21.69.825.57C20.565 22.092 24 17.592 24 12.297c0-6.627-5.373-12-12-12"/></svg></a><a class="VPSocialLink no-icon" href="https://www.linkedin.com/in/jsporna/" aria-label="linkedin" target="_blank" rel="noopener" data-v-7bc22406 data-v-f80f8133><svg role="img" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><title>LinkedIn</title><path d="M20.447 20.452h-3.554v-5.569c0-1.328-.027-3.037-1.852-3.037-1.853 0-2.136 1.445-2.136 2.939v5.667H9.351V9h3.414v1.561h.046c.477-.9 1.637-1.85 3.37-1.85 3.601 0 4.267 2.37 4.267 5.455v6.286zM5.337 7.433c-1.144 0-2.063-.926-2.063-2.065 0-1.138.92-2.063 2.063-2.063 1.14 0 2.064.925 2.064 2.063 0 1.139-.925 2.065-2.064 2.065zm1.782 13.019H3.555V9h3.564v11.452zM22.225 0H1.771C.792 0 0 .774 0 1.729v20.542C0 23.227.792 24 1.771 24h20.451C23.2 24 24 23.227 24 22.271V1.729C24 .774 23.2 0 22.222 0h.003z"/></svg></a><!--]--></div><div class="VPFlyout VPNavBarExtra extra" data-v-a0fd61f4 data-v-d0bd9dde data-v-9c007e85><button type="button" class="button" aria-haspopup="true" aria-expanded="false" aria-label="extra navigation" data-v-9c007e85><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="icon" data-v-9c007e85><circle cx="12" cy="12" r="2"></circle><circle cx="19" cy="12" r="2"></circle><circle cx="5" cy="12" r="2"></circle></svg></button><div class="menu" data-v-9c007e85><div class="VPMenu" data-v-9c007e85 data-v-e7ea1737><!----><!--[--><!--[--><!----><div class="group" data-v-d0bd9dde><div class="item appearance" data-v-d0bd9dde><p class="label" data-v-d0bd9dde>Appearance</p><div class="appearance-action" data-v-d0bd9dde><button class="VPSwitch VPSwitchAppearance" type="button" role="switch" title="toggle dark mode" aria-checked="true" data-v-d0bd9dde data-v-ce54a7d1 data-v-b1685198><span class="check" data-v-b1685198><span class="icon" data-v-b1685198><!--[--><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="sun" data-v-ce54a7d1><path d="M12,18c-3.3,0-6-2.7-6-6s2.7-6,6-6s6,2.7,6,6S15.3,18,12,18zM12,8c-2.2,0-4,1.8-4,4c0,2.2,1.8,4,4,4c2.2,0,4-1.8,4-4C16,9.8,14.2,8,12,8z"></path><path d="M12,4c-0.6,0-1-0.4-1-1V1c0-0.6,0.4-1,1-1s1,0.4,1,1v2C13,3.6,12.6,4,12,4z"></path><path d="M12,24c-0.6,0-1-0.4-1-1v-2c0-0.6,0.4-1,1-1s1,0.4,1,1v2C13,23.6,12.6,24,12,24z"></path><path d="M5.6,6.6c-0.3,0-0.5-0.1-0.7-0.3L3.5,4.9c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0l1.4,1.4c0.4,0.4,0.4,1,0,1.4C6.2,6.5,5.9,6.6,5.6,6.6z"></path><path d="M19.8,20.8c-0.3,0-0.5-0.1-0.7-0.3l-1.4-1.4c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0l1.4,1.4c0.4,0.4,0.4,1,0,1.4C20.3,20.7,20,20.8,19.8,20.8z"></path><path d="M3,13H1c-0.6,0-1-0.4-1-1s0.4-1,1-1h2c0.6,0,1,0.4,1,1S3.6,13,3,13z"></path><path d="M23,13h-2c-0.6,0-1-0.4-1-1s0.4-1,1-1h2c0.6,0,1,0.4,1,1S23.6,13,23,13z"></path><path d="M4.2,20.8c-0.3,0-0.5-0.1-0.7-0.3c-0.4-0.4-0.4-1,0-1.4l1.4-1.4c0.4-0.4,1-0.4,1.4,0s0.4,1,0,1.4l-1.4,1.4C4.7,20.7,4.5,20.8,4.2,20.8z"></path><path d="M18.4,6.6c-0.3,0-0.5-0.1-0.7-0.3c-0.4-0.4-0.4-1,0-1.4l1.4-1.4c0.4-0.4,1-0.4,1.4,0s0.4,1,0,1.4l-1.4,1.4C18.9,6.5,18.6,6.6,18.4,6.6z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="moon" data-v-ce54a7d1><path d="M12.1,22c-0.3,0-0.6,0-0.9,0c-5.5-0.5-9.5-5.4-9-10.9c0.4-4.8,4.2-8.6,9-9c0.4,0,0.8,0.2,1,0.5c0.2,0.3,0.2,0.8-0.1,1.1c-2,2.7-1.4,6.4,1.3,8.4c2.1,1.6,5,1.6,7.1,0c0.3-0.2,0.7-0.3,1.1-0.1c0.3,0.2,0.5,0.6,0.5,1c-0.2,2.7-1.5,5.1-3.6,6.8C16.6,21.2,14.4,22,12.1,22zM9.3,4.4c-2.9,1-5,3.6-5.2,6.8c-0.4,4.4,2.8,8.3,7.2,8.7c2.1,0.2,4.2-0.4,5.8-1.8c1.1-0.9,1.9-2.1,2.4-3.4c-2.5,0.9-5.3,0.5-7.5-1.1C9.2,11.4,8.1,7.7,9.3,4.4z"></path></svg><!--]--></span></span></button></div></div></div><div class="group" data-v-d0bd9dde><div class="item social-links" data-v-d0bd9dde><div class="VPSocialLinks social-links-list" data-v-d0bd9dde data-v-7bc22406><!--[--><a class="VPSocialLink no-icon" href="https://github.com/jsporna" aria-label="github" target="_blank" rel="noopener" data-v-7bc22406 data-v-f80f8133><svg role="img" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><title>GitHub</title><path d="M12 .297c-6.63 0-12 5.373-12 12 0 5.303 3.438 9.8 8.205 11.385.6.113.82-.258.82-.577 0-.285-.01-1.04-.015-2.04-3.338.724-4.042-1.61-4.042-1.61C4.422 18.07 3.633 17.7 3.633 17.7c-1.087-.744.084-.729.084-.729 1.205.084 1.838 1.236 1.838 1.236 1.07 1.835 2.809 1.305 3.495.998.108-.776.417-1.305.76-1.605-2.665-.3-5.466-1.332-5.466-5.93 0-1.31.465-2.38 1.235-3.22-.135-.303-.54-1.523.105-3.176 0 0 1.005-.322 3.3 1.23.96-.267 1.98-.399 3-.405 1.02.006 2.04.138 3 .405 2.28-1.552 3.285-1.23 3.285-1.23.645 1.653.24 2.873.12 3.176.765.84 1.23 1.91 1.23 3.22 0 4.61-2.805 5.625-5.475 5.92.42.36.81 1.096.81 2.22 0 1.606-.015 2.896-.015 3.286 0 .315.21.69.825.57C20.565 22.092 24 17.592 24 12.297c0-6.627-5.373-12-12-12"/></svg></a><a class="VPSocialLink no-icon" href="https://www.linkedin.com/in/jsporna/" aria-label="linkedin" target="_blank" rel="noopener" data-v-7bc22406 data-v-f80f8133><svg role="img" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><title>LinkedIn</title><path d="M20.447 20.452h-3.554v-5.569c0-1.328-.027-3.037-1.852-3.037-1.853 0-2.136 1.445-2.136 2.939v5.667H9.351V9h3.414v1.561h.046c.477-.9 1.637-1.85 3.37-1.85 3.601 0 4.267 2.37 4.267 5.455v6.286zM5.337 7.433c-1.144 0-2.063-.926-2.063-2.065 0-1.138.92-2.063 2.063-2.063 1.14 0 2.064.925 2.064 2.063 0 1.139-.925 2.065-2.064 2.065zm1.782 13.019H3.555V9h3.564v11.452zM22.225 0H1.771C.792 0 0 .774 0 1.729v20.542C0 23.227.792 24 1.771 24h20.451C23.2 24 24 23.227 24 22.271V1.729C24 .774 23.2 0 22.222 0h.003z"/></svg></a><!--]--></div></div></div><!--]--><!--]--></div></div></div><!--[--><!--]--><button type="button" class="VPNavBarHamburger hamburger" aria-label="mobile navigation" aria-expanded="false" aria-controls="VPNavScreen" data-v-a0fd61f4 data-v-e5dd9c1c><span class="container" data-v-e5dd9c1c><span class="top" data-v-e5dd9c1c></span><span class="middle" data-v-e5dd9c1c></span><span class="bottom" data-v-e5dd9c1c></span></span></button></div></div></div></div><!----></header><div class="VPLocalNav fixed reached-top" data-v-5a346dfe data-v-79c8c1df><!----><div class="VPLocalNavOutlineDropdown" style="--vp-vh:0px;" data-v-79c8c1df data-v-1c15a60a><button data-v-1c15a60a>Return to top</button><!----></div></div><!----><div class="VPContent" id="VPContent" data-v-5a346dfe data-v-669faec9><div class="VPDoc has-aside" data-v-669faec9 data-v-6b87e69f><!--[--><!--]--><div class="container" data-v-6b87e69f><div class="aside" data-v-6b87e69f><div class="aside-curtain" data-v-6b87e69f></div><div class="aside-container" data-v-6b87e69f><div class="aside-content" data-v-6b87e69f><div class="VPDocAside" data-v-6b87e69f data-v-3f215769><!--[--><!--]--><!--[--><!--]--><div class="VPDocAsideOutline" role="navigation" data-v-3f215769 data-v-d330b1bb><div class="content" data-v-d330b1bb><div class="outline-marker" data-v-d330b1bb></div><div class="outline-title" role="heading" aria-level="2" data-v-d330b1bb>On this page</div><nav aria-labelledby="doc-outline-aria-label" data-v-d330b1bb><span class="visually-hidden" id="doc-outline-aria-label" data-v-d330b1bb> Table of Contents for current page </span><ul class="root" data-v-d330b1bb data-v-d0ee3533><!--[--><!--]--></ul></nav></div></div><!--[--><!--]--><div class="spacer" data-v-3f215769></div><!--[--><!--]--><!----><!--[--><!--]--><!--[--><!--]--></div></div></div></div><div class="content" data-v-6b87e69f><div class="content-container" data-v-6b87e69f><!--[--><!--]--><!----><main class="main" data-v-6b87e69f><div style="position:relative;" class="vp-doc _blog_waz-w-kieszeni" data-v-6b87e69f><div><h1 id="frontmatter-title" tabindex="-1">Wąż w kieszeni <a class="header-anchor" href="#frontmatter-title" aria-label="Permalink to &quot;{{ $frontmatter.title }}&quot;">​</a></h1><div class="quote"><blockquote><!--[--> Małe jest piękne. <!--]--></blockquote><p>Ernst Friedrich Schumacher</p></div><p>Python jako język programowania uważany jest za bardzo czytelny i samo opisujący się. Charakteryzuje się bardzo zwięzłą formą. Wiele osób miało już okazje rozpisywać się o składni i semantyce tego języka. Ja pójdę krok dalej. Wykorzystam wpływy krakowskie i poznańskie aby zaprzyjaźnić węża z kieszeni z Pythonem - spróbuje zaprezentować minimalizacje już minimalistycznego kodu.</p><h2 id="inspiracja" tabindex="-1">Inspiracja <a class="header-anchor" href="#inspiracja" aria-label="Permalink to &quot;Inspiracja&quot;">​</a></h2><p>Ostatnimi czasy <strong>Maciek Kusz</strong> z bloga <a href="https://testerembyc.pl/" target="_blank" rel="noreferrer">testerembyc.pl</a> pochylił się nad frameworkiem do testów w ramach 16 linii kodu. Swoje rozwiązanie stopniował i wzbogacał funkcjonalnie z zachowaniem założonego limitu. Nie ukrywam miałem swój wpływ na kod ale tylko od strony składniowo-semantycznej bez ingerencji w funkcjonalność.</p><h2 id="_3-grosze" tabindex="-1">3 grosze <a class="header-anchor" href="#_3-grosze" aria-label="Permalink to &quot;3 grosze&quot;">​</a></h2><p>Swój wpływ udokumentowałem w <a href="https://github.com/jsporna/the_smallest_rest_api_testing_framework" target="_blank" rel="noreferrer">forku repozytorium</a> <strong>Maćka</strong>. Przybliżę w tym miejscu swoje zmiany:</p><p>Jako, że plik z kodem będzie uruchamiany a nie importowany to sprawdzanie czy to jest uruchomiony skrypt jest kodem nadmiarowym. Uważam, że ta zmiana nie wymaga większego komentarza.</p><div class="language-python vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#F97583;">if</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">__name__</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">==</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&#39;__main__&#39;</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">    unittest.main(</span><span style="color:#FFAB70;">testRunner</span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;">xmlrunner.XMLTestRunner())</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#D73A49;">if</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">__name__</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">==</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&#39;__main__&#39;</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">    unittest.main(</span><span style="color:#E36209;">testRunner</span><span style="color:#D73A49;">=</span><span style="color:#24292E;">xmlrunner.XMLTestRunner())</span></span></code></pre></div><div class="language-python vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#E1E4E8;">unittest.main(</span><span style="color:#FFAB70;">testRunner</span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;">xmlrunner.XMLTestRunner())</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292E;">unittest.main(</span><span style="color:#E36209;">testRunner</span><span style="color:#D73A49;">=</span><span style="color:#24292E;">xmlrunner.XMLTestRunner())</span></span></code></pre></div><hr><p>Większa zamiana dotyczy zastąpienia definicji funkcji na lambdę.<br> Pierwotnie była zdefiniowana funkcja, która zawierała w sobie definicję funkcji wewnętrznej wykorzystanej do tworzenia atrybutu w ramach przekazanej instancji klasy.</p><div class="language-python vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#F97583;">def</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">add_test</span><span style="color:#E1E4E8;">(cls, name, data):</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">def</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">abstract_test</span><span style="color:#E1E4E8;">(self):</span></span>
<span class="line"><span style="color:#E1E4E8;">       </span><span style="color:#79B8FF;">self</span><span style="color:#E1E4E8;">.assertEqual(requests.request(</span><span style="color:#F97583;">**</span><span style="color:#E1E4E8;">data[</span><span style="color:#9ECBFF;">&#39;request&#39;</span><span style="color:#E1E4E8;">]).status_code, data[</span><span style="color:#9ECBFF;">&#39;assert&#39;</span><span style="color:#E1E4E8;">][</span><span style="color:#9ECBFF;">&#39;statusCode&#39;</span><span style="color:#E1E4E8;">])</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#79B8FF;">setattr</span><span style="color:#E1E4E8;">(</span><span style="color:#79B8FF;">cls</span><span style="color:#E1E4E8;">, name, abstract_test)</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#D73A49;">def</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">add_test</span><span style="color:#24292E;">(cls, name, data):</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">def</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">abstract_test</span><span style="color:#24292E;">(self):</span></span>
<span class="line"><span style="color:#24292E;">       </span><span style="color:#005CC5;">self</span><span style="color:#24292E;">.assertEqual(requests.request(</span><span style="color:#D73A49;">**</span><span style="color:#24292E;">data[</span><span style="color:#032F62;">&#39;request&#39;</span><span style="color:#24292E;">]).status_code, data[</span><span style="color:#032F62;">&#39;assert&#39;</span><span style="color:#24292E;">][</span><span style="color:#032F62;">&#39;statusCode&#39;</span><span style="color:#24292E;">])</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#005CC5;">setattr</span><span style="color:#24292E;">(</span><span style="color:#005CC5;">cls</span><span style="color:#24292E;">, name, abstract_test)</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><div class="language-python vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#79B8FF;">setattr</span><span style="color:#E1E4E8;">(Tests, test_name, </span><span style="color:#F97583;">lambda</span><span style="color:#E1E4E8;"> self: </span><span style="color:#79B8FF;">self</span><span style="color:#E1E4E8;">.assertEqual(requests.request(</span><span style="color:#F97583;">**</span><span style="color:#E1E4E8;">test_data[</span><span style="color:#9ECBFF;">&#39;request&#39;</span><span style="color:#E1E4E8;">]).status_code, test_data[</span><span style="color:#9ECBFF;">&#39;assert&#39;</span><span style="color:#E1E4E8;">][</span><span style="color:#9ECBFF;">&#39;statusCode&#39;</span><span style="color:#E1E4E8;">]))</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#005CC5;">setattr</span><span style="color:#24292E;">(Tests, test_name, </span><span style="color:#D73A49;">lambda</span><span style="color:#24292E;"> self: </span><span style="color:#005CC5;">self</span><span style="color:#24292E;">.assertEqual(requests.request(</span><span style="color:#D73A49;">**</span><span style="color:#24292E;">test_data[</span><span style="color:#032F62;">&#39;request&#39;</span><span style="color:#24292E;">]).status_code, test_data[</span><span style="color:#032F62;">&#39;assert&#39;</span><span style="color:#24292E;">][</span><span style="color:#032F62;">&#39;statusCode&#39;</span><span style="color:#24292E;">]))</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><div class="language-python vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#E1E4E8;">func </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">lambda</span><span style="color:#E1E4E8;"> data: </span><span style="color:#F97583;">lambda</span><span style="color:#E1E4E8;"> self: </span><span style="color:#79B8FF;">self</span><span style="color:#E1E4E8;">.assertEqual(requests.request(</span><span style="color:#F97583;">**</span><span style="color:#E1E4E8;">data[</span><span style="color:#9ECBFF;">&#39;request&#39;</span><span style="color:#E1E4E8;">]).status_code, data[</span><span style="color:#9ECBFF;">&#39;assert&#39;</span><span style="color:#E1E4E8;">][</span><span style="color:#9ECBFF;">&#39;statusCode&#39;</span><span style="color:#E1E4E8;">])</span></span>
<span class="line"><span style="color:#79B8FF;">setattr</span><span style="color:#E1E4E8;">(Tests, test_name, func(test_data))</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292E;">func </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">lambda</span><span style="color:#24292E;"> data: </span><span style="color:#D73A49;">lambda</span><span style="color:#24292E;"> self: </span><span style="color:#005CC5;">self</span><span style="color:#24292E;">.assertEqual(requests.request(</span><span style="color:#D73A49;">**</span><span style="color:#24292E;">data[</span><span style="color:#032F62;">&#39;request&#39;</span><span style="color:#24292E;">]).status_code, data[</span><span style="color:#032F62;">&#39;assert&#39;</span><span style="color:#24292E;">][</span><span style="color:#032F62;">&#39;statusCode&#39;</span><span style="color:#24292E;">])</span></span>
<span class="line"><span style="color:#005CC5;">setattr</span><span style="color:#24292E;">(Tests, test_name, func(test_data))</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>Była ona wywoływana w ramach pętli:</p><div class="language-python vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#F97583;">with</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">open</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&#39;tests.json&#39;</span><span style="color:#E1E4E8;">, </span><span style="color:#9ECBFF;">&#39;r&#39;</span><span style="color:#E1E4E8;">) </span><span style="color:#F97583;">as</span><span style="color:#E1E4E8;"> jfile:</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">for</span><span style="color:#E1E4E8;"> test_name, test_data </span><span style="color:#F97583;">in</span><span style="color:#E1E4E8;"> json.load(jfile).items():</span></span>
<span class="line"><span style="color:#E1E4E8;">        add_test(Tests, test_name, test_data)</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#D73A49;">with</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">open</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&#39;tests.json&#39;</span><span style="color:#24292E;">, </span><span style="color:#032F62;">&#39;r&#39;</span><span style="color:#24292E;">) </span><span style="color:#D73A49;">as</span><span style="color:#24292E;"> jfile:</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">for</span><span style="color:#24292E;"> test_name, test_data </span><span style="color:#D73A49;">in</span><span style="color:#24292E;"> json.load(jfile).items():</span></span>
<span class="line"><span style="color:#24292E;">        add_test(Tests, test_name, test_data)</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>Zastąpienie funkcji wewnętrznej poprzez lambdę, która została umieszczona w wywołaniu funkcji <strong>settattr</strong> pozwoliło zaoszczędzić kilka linii kodu bez utraty funkcjonalności.<br> Niestety pojawił się tu mały problem. Pomimo pętli na danych lambda została utworzona raz a przekazywane do jej wnętrza zmienne zostały przekazane poprzez referencję a nie wartość. Skutkiem tego jest utworzenie atrybutów o tych samych wartościach - wartościach wczytanych w ostatnim przebiegu pętli <strong>for</strong>.<br> Rozwiązaniem na to jest wydzielenie lambdy do osobnej linii i obudowanie jej w kolejną lambdę. Pozwala to na przekazania niezbędnych zmiennych poprzez wartość. W ten sposób do funkcji <strong>setattr</strong> jest przekazane wywołanie lambdy, która zwraca niezbędny wywoływalny obiekt oczekiwany przez tą funkcję.</p><hr><p>Kolejna optymalizacja nastąpiła już na kodzie, który Maciek wzbogacił o dodatkowe funkcjonalności.</p><div class="language-python vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#F97583;">for</span><span style="color:#E1E4E8;"> file_name </span><span style="color:#F97583;">in</span><span style="color:#E1E4E8;"> glob.iglob(</span><span style="color:#9ECBFF;">&quot;*.json&quot;</span><span style="color:#E1E4E8;">):</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">with</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">open</span><span style="color:#E1E4E8;">(file_name, </span><span style="color:#9ECBFF;">&#39;r&#39;</span><span style="color:#E1E4E8;">) </span><span style="color:#F97583;">as</span><span style="color:#E1E4E8;"> json_file:</span></span>
<span class="line"><span style="color:#E1E4E8;">        test </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">lambda</span><span style="color:#E1E4E8;"> data: </span><span style="color:#F97583;">lambda</span><span style="color:#E1E4E8;"> self: abstract_test(</span><span style="color:#79B8FF;">self</span><span style="color:#E1E4E8;">, data)</span></span>
<span class="line"><span style="color:#E1E4E8;">        suite_name </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> file_name.split(</span><span style="color:#9ECBFF;">&#39;.&#39;</span><span style="color:#E1E4E8;">)[</span><span style="color:#79B8FF;">0</span><span style="color:#E1E4E8;">]</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#79B8FF;">globals</span><span style="color:#E1E4E8;">()[suite_name] </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">type</span><span style="color:#E1E4E8;">(suite_name, (unittest.TestCase,), {name: test(data) </span><span style="color:#F97583;">for</span><span style="color:#E1E4E8;"> name, data </span><span style="color:#F97583;">in</span><span style="color:#E1E4E8;"> json.load(json_file).items()})</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#D73A49;">for</span><span style="color:#24292E;"> file_name </span><span style="color:#D73A49;">in</span><span style="color:#24292E;"> glob.iglob(</span><span style="color:#032F62;">&quot;*.json&quot;</span><span style="color:#24292E;">):</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">with</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">open</span><span style="color:#24292E;">(file_name, </span><span style="color:#032F62;">&#39;r&#39;</span><span style="color:#24292E;">) </span><span style="color:#D73A49;">as</span><span style="color:#24292E;"> json_file:</span></span>
<span class="line"><span style="color:#24292E;">        test </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">lambda</span><span style="color:#24292E;"> data: </span><span style="color:#D73A49;">lambda</span><span style="color:#24292E;"> self: abstract_test(</span><span style="color:#005CC5;">self</span><span style="color:#24292E;">, data)</span></span>
<span class="line"><span style="color:#24292E;">        suite_name </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> file_name.split(</span><span style="color:#032F62;">&#39;.&#39;</span><span style="color:#24292E;">)[</span><span style="color:#005CC5;">0</span><span style="color:#24292E;">]</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#005CC5;">globals</span><span style="color:#24292E;">()[suite_name] </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">type</span><span style="color:#24292E;">(suite_name, (unittest.TestCase,), {name: test(data) </span><span style="color:#D73A49;">for</span><span style="color:#24292E;"> name, data </span><span style="color:#D73A49;">in</span><span style="color:#24292E;"> json.load(json_file).items()})</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><div class="language-python vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#E1E4E8;">test </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">lambda</span><span style="color:#E1E4E8;"> data: </span><span style="color:#F97583;">lambda</span><span style="color:#E1E4E8;"> self: abstract_test(</span><span style="color:#79B8FF;">self</span><span style="color:#E1E4E8;">, data, requests.request(</span><span style="color:#F97583;">**</span><span style="color:#E1E4E8;">data[</span><span style="color:#9ECBFF;">&#39;request&#39;</span><span style="color:#E1E4E8;">]))</span></span>
<span class="line"><span style="color:#79B8FF;">globals</span><span style="color:#E1E4E8;">().update({file_name: </span><span style="color:#79B8FF;">type</span><span style="color:#E1E4E8;">(file_name, (unittest.TestCase, ), {name: test(data) </span><span style="color:#F97583;">for</span><span style="color:#E1E4E8;"> name, data </span><span style="color:#F97583;">in</span><span style="color:#E1E4E8;"> json.load(</span><span style="color:#79B8FF;">open</span><span style="color:#E1E4E8;">(file_name, </span><span style="color:#9ECBFF;">&#39;r&#39;</span><span style="color:#E1E4E8;">)).items() }) </span><span style="color:#F97583;">for</span><span style="color:#E1E4E8;"> file_name </span><span style="color:#F97583;">in</span><span style="color:#E1E4E8;"> glob.iglob(</span><span style="color:#9ECBFF;">&quot;*.json&quot;</span><span style="color:#E1E4E8;">)})</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292E;">test </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">lambda</span><span style="color:#24292E;"> data: </span><span style="color:#D73A49;">lambda</span><span style="color:#24292E;"> self: abstract_test(</span><span style="color:#005CC5;">self</span><span style="color:#24292E;">, data, requests.request(</span><span style="color:#D73A49;">**</span><span style="color:#24292E;">data[</span><span style="color:#032F62;">&#39;request&#39;</span><span style="color:#24292E;">]))</span></span>
<span class="line"><span style="color:#005CC5;">globals</span><span style="color:#24292E;">().update({file_name: </span><span style="color:#005CC5;">type</span><span style="color:#24292E;">(file_name, (unittest.TestCase, ), {name: test(data) </span><span style="color:#D73A49;">for</span><span style="color:#24292E;"> name, data </span><span style="color:#D73A49;">in</span><span style="color:#24292E;"> json.load(</span><span style="color:#005CC5;">open</span><span style="color:#24292E;">(file_name, </span><span style="color:#032F62;">&#39;r&#39;</span><span style="color:#24292E;">)).items() }) </span><span style="color:#D73A49;">for</span><span style="color:#24292E;"> file_name </span><span style="color:#D73A49;">in</span><span style="color:#24292E;"> glob.iglob(</span><span style="color:#032F62;">&quot;*.json&quot;</span><span style="color:#24292E;">)})</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>Od czego wyszliśmy? Iteracja po plikach, które są otwierane poprzez <strong>context managera</strong>, przygotowanie lambdy (<strong>test</strong>) oraz nazwy dla klasy (<strong>suite_name</strong>) oraz dopisywanie do słownika <strong>globals()</strong> nowych instancji klasy dziedziczącej po <strong>unittest.TestCase</strong>. Tworzenie instancji klasy zawiera w sobie <strong>dict comprehension</strong>, które iteruje po zawartości wczytanego pliku.</p><p>Oszczędność została osiągnięta poprzez zagnieżdżenie <strong>list comprehension</strong> w <strong>dict comprehension</strong> oraz kolejne zagnieżdżenie w <strong>dict comprehension</strong>.<br> Idąc od najbardziej wewnętrznej struktury - <strong>list comprehension</strong> zastępuje zewnętrzną pętlę for.<br> Jest ona zagnieżdżona w <strong>dict comprehension</strong> odpowiedzialnym za iteracje po danych wczytanych z plików czyli rozszerzyliśmy oryginalną strukturę. Kolejno został dodany zewnętrzny <strong>dict comprehension</strong> w celu wygenerowania słownika, którym rozszerzymy <strong>globals()</strong> zamiast dopisywać pojedyncze klucze i ich wartości.</p><h3 id="rachunek" tabindex="-1">Rachunek <a class="header-anchor" href="#rachunek" aria-label="Permalink to &quot;Rachunek&quot;">​</a></h3><p>Dwukrotnie udało wspólnymi siłami zredukować kod z 15/16 do 10 linii.</p><h2 id="_9-groszy" tabindex="-1">9 groszy <a class="header-anchor" href="#_9-groszy" aria-label="Permalink to &quot;9 groszy&quot;">​</a></h2><h3 id="mamy" tabindex="-1">Mamy <a class="header-anchor" href="#mamy" aria-label="Permalink to &quot;Mamy&quot;">​</a></h3><p>Mieliśmy funkcje bez funkcji - lambda.<br> Mieliśmy klasę bez definicji - type -&gt; <a href="https://testerembyc.pl/posts/jeszcze-mniejszy-framework-do-testow-w-pythonie/#type" target="_blank" rel="noreferrer">opis Maćka</a>.<br> Mieliśmy instancje klasy bez klasy - setattr.<br> Mieliśmy globalne obiekty bez obiektów - globals().</p><h3 id="co-jeszcze" tabindex="-1">Co jeszcze? <a class="header-anchor" href="#co-jeszcze" aria-label="Permalink to &quot;Co jeszcze?&quot;">​</a></h3><p>Co tu jeszcze można dodać bez dodawania?<br> Odwróciłem rozwiązanie Maćka o 180° i postanowiłem stworzyć REST API w jak najmniejszej linii kodu a zarazem żeby było w pełni funkcjonalne - funkcjonalnością odpowiadało testom wykonywanym przez framework. Wykorzystałem do tego framework <a href="https://fastapi.tiangolo.com/" target="_blank" rel="noreferrer">fastapi</a>. Ale co tu jest innego niż do tej pory było? Będziemy generować funkcje, które posiadają dekorator czyli funkcję, której argumentem staje się udekorowana funkcja.</p><div class="language-python vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#F97583;">import</span><span style="color:#E1E4E8;"> fastapi</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">app </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> fastapi.FastAPI()</span></span>
<span class="line"></span>
<span class="line"><span style="color:#B392F0;">@app.get</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&quot;/&quot;</span><span style="color:#E1E4E8;">)</span></span>
<span class="line"><span style="color:#F97583;">def</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">index</span><span style="color:#E1E4E8;">():</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">return</span><span style="color:#E1E4E8;"> {</span><span style="color:#9ECBFF;">&quot;message&quot;</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">&quot;Hello from FastAPI&quot;</span><span style="color:#E1E4E8;">}</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#D73A49;">import</span><span style="color:#24292E;"> fastapi</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">app </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> fastapi.FastAPI()</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1;">@app.get</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&quot;/&quot;</span><span style="color:#24292E;">)</span></span>
<span class="line"><span style="color:#D73A49;">def</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">index</span><span style="color:#24292E;">():</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">return</span><span style="color:#24292E;"> {</span><span style="color:#032F62;">&quot;message&quot;</span><span style="color:#24292E;">: </span><span style="color:#032F62;">&quot;Hello from FastAPI&quot;</span><span style="color:#24292E;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><h3 id="pierwsze-spojrzenie" tabindex="-1">Pierwsze spojrzenie <a class="header-anchor" href="#pierwsze-spojrzenie" aria-label="Permalink to &quot;Pierwsze spojrzenie&quot;">​</a></h3><p>No to można powiedzieć, jak mamy funkcję dekoratora no to problem z głowy.</p><div class="language-python vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#E1E4E8;">app.get(</span><span style="color:#9ECBFF;">&quot;/&quot;</span><span style="color:#E1E4E8;">, </span><span style="color:#F97583;">lambda</span><span style="color:#E1E4E8;">: {</span><span style="color:#9ECBFF;">&quot;message&quot;</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">&quot;Hello from FastAPI&quot;</span><span style="color:#E1E4E8;">})</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292E;">app.get(</span><span style="color:#032F62;">&quot;/&quot;</span><span style="color:#24292E;">, </span><span style="color:#D73A49;">lambda</span><span style="color:#24292E;">: {</span><span style="color:#032F62;">&quot;message&quot;</span><span style="color:#24292E;">: </span><span style="color:#032F62;">&quot;Hello from FastAPI&quot;</span><span style="color:#24292E;">})</span></span></code></pre></div><p>Niestety to nie zadziała ponieważ ani funkcja <strong>app.get()</strong> ani funkcja przez nią zwracana <strong>app.router.post()</strong> nie posiada jako argument funkcji dekorowanej.</p><h3 id="otchłan" tabindex="-1">Otchłań <a class="header-anchor" href="#otchłan" aria-label="Permalink to &quot;Otchłań&quot;">​</a></h3><p>Idąc po nici do kłębka możemy się dowiedzieć, że <strong>app.router</strong> jest instancją <strong>fastapi.routing.APIRouter</strong>.<br> No to schodzimy niżej i fedrujemy. Klasa <strong>APIRouter</strong> w swoich metodach posiada wspomnianą funkcję <strong>get</strong>, która natomiast zwraca funkcje <strong>api_route</strong>, która nadal nie posiada argumentu dla dekorowanej funkcji. Dopiero ta ostatnia zwraca funkcję <strong>add_api_route</strong>, której drugim argumentem jest szukane <strong>func</strong>. Sukces!</p><div class="language-python vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#E1E4E8;">app.get() → fastapi.FastAPI.get()</span></span>
<span class="line"><span style="color:#E1E4E8;">↓</span></span>
<span class="line"><span style="color:#E1E4E8;">app.router.get() → fastapi.routing.APIRouter.get()</span></span>
<span class="line"><span style="color:#E1E4E8;">↓</span></span>
<span class="line"><span style="color:#E1E4E8;">app.router.api_route() → fastapi.routing.APIRouter.api_route()</span></span>
<span class="line"><span style="color:#E1E4E8;">↓</span></span>
<span class="line"><span style="color:#E1E4E8;">app.router.add_api_route() → fastapi.routing.APIRouter.add_api_route()</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292E;">app.get() → fastapi.FastAPI.get()</span></span>
<span class="line"><span style="color:#24292E;">↓</span></span>
<span class="line"><span style="color:#24292E;">app.router.get() → fastapi.routing.APIRouter.get()</span></span>
<span class="line"><span style="color:#24292E;">↓</span></span>
<span class="line"><span style="color:#24292E;">app.router.api_route() → fastapi.routing.APIRouter.api_route()</span></span>
<span class="line"><span style="color:#24292E;">↓</span></span>
<span class="line"><span style="color:#24292E;">app.router.add_api_route() → fastapi.routing.APIRouter.add_api_route()</span></span></code></pre></div><p>I co teraz z tym możemy zrobić? Bardzo wiele.<br> Poczynając od określenia ścieżki (<strong>path</strong>), metod (<strong>methods</strong>), kodu odpowiedzi (<strong>status_code</strong>), możemy określić model odpowiedzi (<strong>response_model</strong>) i wiele meta parametrów odpowiedzialnych za opis słowno-muzyczny.</p><h3 id="piekło-czy-niebo" tabindex="-1">Piekło czy Niebo <a class="header-anchor" href="#piekło-czy-niebo" aria-label="Permalink to &quot;Piekło czy Niebo&quot;">​</a></h3><p>Docelowo otrzymujemy:</p><div class="language-python vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#E1E4E8;">app.router.add_api_route(</span><span style="color:#9ECBFF;">&quot;/&quot;</span><span style="color:#E1E4E8;">, </span><span style="color:#F97583;">lambda</span><span style="color:#E1E4E8;">: {</span><span style="color:#9ECBFF;">&quot;message&quot;</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">&quot;Hello from FastAPI&quot;</span><span style="color:#E1E4E8;">})</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292E;">app.router.add_api_route(</span><span style="color:#032F62;">&quot;/&quot;</span><span style="color:#24292E;">, </span><span style="color:#D73A49;">lambda</span><span style="color:#24292E;">: {</span><span style="color:#032F62;">&quot;message&quot;</span><span style="color:#24292E;">: </span><span style="color:#032F62;">&quot;Hello from FastAPI&quot;</span><span style="color:#24292E;">})</span></span></code></pre></div><p>Tworząc strukturę dla endpointów podobną do tej dla testów:</p><div class="language-json vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">json</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#E1E4E8;">{</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#79B8FF;">&quot;name&quot;</span><span style="color:#E1E4E8;">: {</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#79B8FF;">&quot;path&quot;</span><span style="color:#E1E4E8;">: </span><span style="color:#FDAEB7;font-style:italic;">str</span><span style="color:#E1E4E8;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#79B8FF;">&quot;methods&quot;</span><span style="color:#E1E4E8;">: </span><span style="color:#FDAEB7;font-style:italic;">List</span><span style="color:#E1E4E8;">[</span><span style="color:#FDAEB7;font-style:italic;">str</span><span style="color:#E1E4E8;">],</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#79B8FF;">&quot;status_code&quot;</span><span style="color:#E1E4E8;">: </span><span style="color:#FDAEB7;font-style:italic;">int</span><span style="color:#E1E4E8;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#79B8FF;">&quot;returns&quot;</span><span style="color:#E1E4E8;">: </span><span style="color:#FDAEB7;font-style:italic;">List</span><span style="color:#E1E4E8;">[</span><span style="color:#FDAEB7;font-style:italic;">str</span><span style="color:#E1E4E8;">]</span></span>
<span class="line"><span style="color:#E1E4E8;">  }</span></span>
<span class="line"><span style="color:#E1E4E8;">}</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292E;">{</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#005CC5;">&quot;name&quot;</span><span style="color:#24292E;">: {</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#005CC5;">&quot;path&quot;</span><span style="color:#24292E;">: </span><span style="color:#B31D28;font-style:italic;">str</span><span style="color:#24292E;">,</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#005CC5;">&quot;methods&quot;</span><span style="color:#24292E;">: </span><span style="color:#B31D28;font-style:italic;">List</span><span style="color:#24292E;">[</span><span style="color:#B31D28;font-style:italic;">str</span><span style="color:#24292E;">],</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#005CC5;">&quot;status_code&quot;</span><span style="color:#24292E;">: </span><span style="color:#B31D28;font-style:italic;">int</span><span style="color:#24292E;">,</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#005CC5;">&quot;returns&quot;</span><span style="color:#24292E;">: </span><span style="color:#B31D28;font-style:italic;">List</span><span style="color:#24292E;">[</span><span style="color:#B31D28;font-style:italic;">str</span><span style="color:#24292E;">]</span></span>
<span class="line"><span style="color:#24292E;">  }</span></span>
<span class="line"><span style="color:#24292E;">}</span></span></code></pre></div><p>Jesteśmy wstanie stworzyć działające REST API serwis dosłownie w kilku liniach kodu:</p><div class="language-python vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#F97583;">import</span><span style="color:#E1E4E8;"> fastapi, json</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">app </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> fastapi.FastAPI()</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583;">for</span><span style="color:#E1E4E8;"> name, values </span><span style="color:#F97583;">in</span><span style="color:#E1E4E8;"> json.load(</span><span style="color:#79B8FF;">open</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&quot;routes.json&quot;</span><span style="color:#E1E4E8;">, </span><span style="color:#9ECBFF;">&quot;r&quot;</span><span style="color:#E1E4E8;">)).items():</span></span>
<span class="line"><span style="color:#E1E4E8;">   func </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">lambda</span><span style="color:#E1E4E8;"> data: </span><span style="color:#F97583;">lambda</span><span style="color:#E1E4E8;">: {item: item </span><span style="color:#F97583;">for</span><span style="color:#E1E4E8;"> item </span><span style="color:#F97583;">in</span><span style="color:#E1E4E8;"> data}</span></span>
<span class="line"><span style="color:#E1E4E8;">   app.router.add_api_route(values[</span><span style="color:#9ECBFF;">&#39;path&#39;</span><span style="color:#E1E4E8;">], func(values.get(</span><span style="color:#9ECBFF;">&#39;returns&#39;</span><span style="color:#E1E4E8;">, [])), </span><span style="color:#FFAB70;">name</span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;">name, </span><span style="color:#FFAB70;">methods</span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;">values[</span><span style="color:#9ECBFF;">&#39;methods&#39;</span><span style="color:#E1E4E8;">], </span><span style="color:#FFAB70;">status_code</span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;">values[</span><span style="color:#9ECBFF;">&#39;status_code&#39;</span><span style="color:#E1E4E8;">])</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#D73A49;">import</span><span style="color:#24292E;"> fastapi, json</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">app </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> fastapi.FastAPI()</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;">for</span><span style="color:#24292E;"> name, values </span><span style="color:#D73A49;">in</span><span style="color:#24292E;"> json.load(</span><span style="color:#005CC5;">open</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&quot;routes.json&quot;</span><span style="color:#24292E;">, </span><span style="color:#032F62;">&quot;r&quot;</span><span style="color:#24292E;">)).items():</span></span>
<span class="line"><span style="color:#24292E;">   func </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">lambda</span><span style="color:#24292E;"> data: </span><span style="color:#D73A49;">lambda</span><span style="color:#24292E;">: {item: item </span><span style="color:#D73A49;">for</span><span style="color:#24292E;"> item </span><span style="color:#D73A49;">in</span><span style="color:#24292E;"> data}</span></span>
<span class="line"><span style="color:#24292E;">   app.router.add_api_route(values[</span><span style="color:#032F62;">&#39;path&#39;</span><span style="color:#24292E;">], func(values.get(</span><span style="color:#032F62;">&#39;returns&#39;</span><span style="color:#24292E;">, [])), </span><span style="color:#E36209;">name</span><span style="color:#D73A49;">=</span><span style="color:#24292E;">name, </span><span style="color:#E36209;">methods</span><span style="color:#D73A49;">=</span><span style="color:#24292E;">values[</span><span style="color:#032F62;">&#39;methods&#39;</span><span style="color:#24292E;">], </span><span style="color:#E36209;">status_code</span><span style="color:#D73A49;">=</span><span style="color:#24292E;">values[</span><span style="color:#032F62;">&#39;status_code&#39;</span><span style="color:#24292E;">])</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p>Można z linii 5 i 7 zrobić list comprehension.<br> Funkcje add_api_route możemy zamienić na operacjach na liście app.router.routes.<br> ...</p><h3 id="napiwek" tabindex="-1">Napiwek <a class="header-anchor" href="#napiwek" aria-label="Permalink to &quot;Napiwek&quot;">​</a></h3><p>Tu nasuwa się pytanie czy jaka &quot;optymalizacja&quot; nie ma końca? Co tym osiągniemy: programistyczne Piekło czy Niebo?</p><p>Nie jest sztuka dla sztuki! W dobie gdzie wszystko jest w Internecie, jest online ogrom danych jest pobieranych, przetwarzanych uruchamianych. Ciągły rozwój zapewnia coraz szybszy i szerszy dostęp do sieci Internet ale są miejsca gdzie kod jest limitowany.</p><p>Za przykład posłuży mi <a href="https://aws.amazon.com/lambda/" target="_blank" rel="noreferrer">AWS Lambda</a>.<br> Posiada ona limit 50MB spakowanego kodu, 250MB rozpakowanego kodu, 3MB edytor w konsoli. 250MB to ogrom ale AWS Lambda liczy nie tylko kod napisany przez nas ale również wszystkie moduły niezbędne do uruchomienia tego kodu.<br> Za przykład niech posłuży moje 7 linii kodu - to jedyne 324B. Natomiast wszystkie niezbędne moduły to już 88MB.</p><p>Kiedy zależności doprowadzą nas do limitu to optymalizować / minimalizować możemy już tylko swój kod.</p><h2 id="_10-groszy" tabindex="-1">10 groszy <a class="header-anchor" href="#_10-groszy" aria-label="Permalink to &quot;10 groszy&quot;">​</a></h2><p>Jedna rzecz nie została utworzona w sposób generyczny: <strong>funkcja z dynamiczną listą argumentów</strong>. A to już nie jest obszar gdzie ubywa kodu, wręcz przeciwnie to tu kod płynie szerokim strumieniem.<br> Czym to możemy osiągnąć? Python w swojej standardowej bilbiotece ma moduł <strong>inspect</strong> a w nim jest klasa <strong>Signature</strong>.</p><p>Ale już więcej nie powiem. Pozostawiam do zgłębienia dla chętnych i szczerze potrzebujących takiego podejścia.</p></div></div></main><footer class="VPDocFooter" data-v-6b87e69f data-v-ef5dee53><!--[--><!--]--><!----><!----></footer><!--[--><!--]--></div></div></div><!--[--><!--]--></div></div><!----><!--[--><!--]--></div></div>
    <script>window.__VP_HASH_MAP__=JSON.parse("{\"blog_przeszczep-wiedzy.md\":\"b8e951ca\",\"blog.md\":\"db7bd673\",\"index.md\":\"3d9a1df7\",\"contact.md\":\"0a8d9713\",\"offer.md\":\"643e3ca2\",\"blog_swiatlo-w-tunelach.md\":\"2e994bd5\",\"blog_wejscie-do-jamy-smoka.md\":\"20da19bf\",\"blog_waz-w-kieszeni.md\":\"4cf10ffc\"}");window.__VP_SITE_DATA__=JSON.parse("{\"lang\":\"en-US\",\"dir\":\"ltr\",\"title\":\"sporna.dev\",\"description\":\"A VitePress site\",\"base\":\"/\",\"head\":[],\"appearance\":\"dark\",\"themeConfig\":{\"nav\":[{\"text\":\"O mnie\",\"link\":\"/index\",\"activeMatch\":\"/index\"},{\"text\":\"Kontakt\",\"link\":\"/contact\",\"activeMatch\":\"/contact\"},{\"text\":\"Oferta\",\"link\":\"/offer\",\"activeMatch\":\"/offer\"},{\"text\":\"Blog\",\"link\":\"/blog\",\"activeMatch\":\"/blog\"}],\"socialLinks\":[{\"icon\":\"github\",\"link\":\"https://github.com/jsporna\"},{\"icon\":\"linkedin\",\"link\":\"https://www.linkedin.com/in/jsporna/\"}],\"outline\":[2,6]},\"locales\":{},\"scrollOffset\":90,\"cleanUrls\":false}");</script>
    
  </body>
</html>